{
  "hash": "9844653c91bf2eba235bda563d50a973",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Workflow with tidymodels\nexecute:\n  warning: false\n  error: false\nsidebar:\n  contents: auto\nnumber-sections: true\n---\n\n\n\n\n# Library and Data\n\nIn this article we will use `tidymodels` to walk through the complete machine learning workflow step by step in a tidy and ecological way.\n\nThe entire article is based on the case study from:\n[https://www.tidymodels.org/start/case-study/](https://www.tidymodels.org/start/case-study/)\nAll exercises will use the data included in that example.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ntheme_set(theme_bw())\n\nlibrary(tidymodels)  # parsnip + all other tidymodels packages\n\n# Helper packages\nlibrary(readr)       # for importing data\nlibrary(broom.mixed) # for converting Bayesian models to tidy tibbles\nlibrary(dotwhisker)  # for visualizing regression results\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## data import ----------\ndf_Urchins <-\n  read_csv(\"https://tidymodels.org/start/models/urchins.csv\") |>  \n  setNames(c(\"food_regime\", \"initial_volume\", \"width\")) |> \n  mutate(food_regime = factor(food_regime, levels = c(\"Initial\", \"Low\", \"High\")))\n\n## explore the relationship --------------\nggplot(df_Urchins,\n       aes(x = initial_volume, \n           y = width, \n           group = food_regime, \n           col = food_regime)) + \n  geom_point() + \n  geom_smooth(method = lm, se = FALSE) +\n  scale_color_viridis_d(option = \"plasma\", end = .7)\n```\n\n::: {.cell-output-display}\n![](ml_tidymodels_basic_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\nIn this exercise we explore the relationship between sea urchin width (target), initial volume (feature 1), and food regime (feature 2).\nThe variable *initial volume* is continuous, while *food regime* is categorical.\nA basic model description can be written as:\n\n```r\nwidth ~ initial_volume * food_regime\n```\n\n# Basic Model Building and Fitting\n\n## Build the model\n\nWe start with a simple linear regression model using `linear_reg()`.\n`tidymodels` is a meta-package that collects several modeling tools; `parsnip` allows us to choose the computational engine we prefer.\nYou can find all available engines here:\n[https://parsnip.tidymodels.org/reference/linear_reg.html](https://parsnip.tidymodels.org/reference/linear_reg.html)\n\n1. choose the method\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinear_reg()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n```\n\n\n:::\n:::\n\n\n\n2. choose an engine\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinear_reg() |> \n  set_engine(\"lm\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n```\n\n\n:::\n:::\n\n\n\n3. build the model specification\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmdl_Linear <- linear_reg()\n```\n:::\n\n\n\n## Train (fit) the model\n\nAfter specifying the model, we can train (fit) it to our data.\nThe `fit()` function requires:\n\n1. the model object\n2. a formula\n3. the dataset\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_Linear <- \n  mdl_Linear |> \n  fit(width ~ initial_volume * food_regime, data = df_Urchins)\n\nfit_Linear\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nparsnip model object\n\n\nCall:\nstats::lm(formula = width ~ initial_volume * food_regime, data = data)\n\nCoefficients:\n                   (Intercept)                  initial_volume  \n                     0.0331216                       0.0015546  \n                food_regimeLow                 food_regimeHigh  \n                     0.0197824                       0.0214111  \n initial_volume:food_regimeLow  initial_volume:food_regimeHigh  \n                    -0.0012594                       0.0005254  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(fit_Linear)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n  term                            estimate std.error statistic  p.value\n  <chr>                              <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)                     0.0331    0.00962      3.44  0.00100 \n2 initial_volume                  0.00155   0.000398     3.91  0.000222\n3 food_regimeLow                  0.0198    0.0130       1.52  0.133   \n4 food_regimeHigh                 0.0214    0.0145       1.47  0.145   \n5 initial_volume:food_regimeLow  -0.00126   0.000510    -2.47  0.0162  \n6 initial_volume:food_regimeHigh  0.000525  0.000702     0.748 0.457   \n```\n\n\n:::\n:::\n\n\n\n## Predict with the fitted model\n\nAfter fitting, we can already use the model to make predictions.\nTo predict we need:\n\n1. a dataset containing the feature variables with the same names as in the training data\n2. the fitted model\n\nBy default, `predict()` returns the mean prediction:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_NewData <- expand.grid(\n  initial_volume = 20, \n  food_regime = c(\"Initial\", \"Low\", \"High\")\n)\n\npred_Mean <- predict(fit_Linear, new_data = df_NewData)\npred_Mean\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 1\n   .pred\n   <dbl>\n1 0.0642\n2 0.0588\n3 0.0961\n```\n\n\n:::\n:::\n\n\n\nWe can also request confidence intervals using `type = \"conf_int\"`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_Conf <- predict(\n  fit_Linear, \n  new_data = df_NewData, \n  type = \"conf_int\"\n)\npred_Conf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  .pred_lower .pred_upper\n        <dbl>       <dbl>\n1      0.0555      0.0729\n2      0.0499      0.0678\n3      0.0870      0.105 \n```\n\n\n:::\n:::\n",
    "supporting": [
      "ml_tidymodels_basic_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}